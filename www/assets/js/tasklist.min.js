let datatable;function initDataTable(){$.fn.dataTable.ext.buttons.new={action:promptForNewTask,className:"new btn-sm btn-primary",init:function(t,a,e){$(a).removeClass("btn-secondary"),$(a).attr({title:"Add new task"})},text:"New"},datatable=$("table").DataTable({processing:!0,buttons:["new"],dom:'<"row"<"col-sm-6"l><"col-sm-6"Bf>>rtip',ajax:{url:"/api/v1/tasks",dataSrc:""},columns:[{data:"id"},{data:"task",render:function(t){return`${`<a href="#" class="edit" title="Edit">${t}</a>`}<input class="edit-input form-control form-control-sm" maxlength="255" hidden /><div class="invalid-feedback"></div>`}},{data:"is_done",render:function(t){return`<a href="#" class="is_done" title="${t?"Un-complete":"Complete"}"><i class="fa fa-lg ${t?"fa-check-square-o":"fa-square-o"}"></i></a>`}},{orderable:!1,render:function(){return'<a href="#" title="Delete" class="delete text-danger"><i class="fa fa-lg fa-trash"></i></a>'}}]})}function promptForNewTask(t){let a=$.trim(prompt("Enter new task"));a&&a.length>0&&$.ajax({type:"POST",url:"/api/v1/tasks",dataType:"json",data:{task:a},success:function(t){datatable.ajax.reload(null,!1)},error:function(t,a,e){alert(t.responseJSON.message),promptForNewTask()}})}function onIsDoneClick(t){t.preventDefault(),t.stopPropagation();let a=$(this).closest("tr"),e=$(this).find("i").hasClass("fa-square-o")?1:0,n=datatable.row(a).data();$.ajax({type:"PUT",url:`/api/v1/tasks/${n.id}`,dataType:"json",data:{...n,is_done:e},success:function(t){datatable.row(a).data(t).draw(!1)}})}function onEditClick(t){t.preventDefault(),t.stopPropagation();let a=$(this),e=$(a).next("input.edit-input"),n=($(e).next("div.invalid-feedback"),$(a).closest("tr")),s=datatable.row(n).data();$(a).prop({hidden:!0}),$(e).val(s.task).prop({hidden:!1}).focus()}function onEditComplete(t){let a=$(this).prev("a.edit"),e=$(a).next("input.edit-input"),n=$(e).next("div.invalid-feedback"),s=$.trim($(e).val()),i=$(a).closest("tr"),o=datatable.row(i).data();o.task!==s?$.ajax({type:"PUT",url:`/api/v1/tasks/${o.id}`,dataType:"json",data:{...o,task:s},success:function(t){$(e).removeClass("is-invalid"),$(n).empty(),datatable.row(i).data(t).draw(!1)},error:function(t,a,s){$(n).text(t.responseJSON.message),$(e).addClass("is-invalid").val(o.task).focus()}}):($(a).prop({hidden:!1}),$(e).prop({hidden:!0}).removeClass("is-invalid"),$(n).empty())}function onTaskKeyPress(t){13===t.keyCode&&$(this).blur()}function onDeleteClick(t){t.preventDefault(),t.stopPropagation();let a=$(this).closest("tr"),e=datatable.row(a).data();$.ajax({type:"DELETE",url:`/api/v1/tasks/${e.id}`,dataType:"json",complete:function(){datatable.row(a).remove().draw(!1)}})}$(document).ready(function(){initDataTable(),$("table").on("click","a.edit",onEditClick).on("blur","input.edit-input",onEditComplete).on("keypress","input.edit-input",onTaskKeyPress).on("click","a.is_done",onIsDoneClick).on("click","a.delete",onDeleteClick)});